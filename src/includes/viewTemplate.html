<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Automarker Submission</title>
		<link rel="stylesheet" href="/common/bootstrap/css/bootstrap.min.css" type="text/css" media="screen" charset="utf-8">
		<link rel="stylesheet" href="{{codemirror_css}}" type="text/css" media="screen" charset="utf-8">
		<script src="/common/jquery.min.js"></script>
		<script src="/common/bootstrap/js/bootstrap.min.js"></script>
		<script src="{{codemirror_js}}"></script>
		<script src="{{codemirror_mode_js}}"></script>

		{{&app_init_js}}

		<style type="text/css">
		.CodeMirror-scroll {
			height: auto;
			min-height: 320px;
			overflow-y: hidden;
			overflow-x: auto;
		}

		.markup {
			-webkit-border-radius: 4px;
			-moz-border-radius: 4px;
			border-radius: 4px;
			border: 1px solid #ccc;
			padding: 5px;
		}
		
		.markup a {
			color: #42719E;
			text-decoration: none;
		}

		.markup a:hover {
			color: #42719E;
			text-decoration: underline;
		}

		.markup .monospace {
			font-family: monospace;
			white-space: pre;
		}

		.markup .typefaceSize_plus_1 {
			font-size: 13pt;
		}

		.markup .typefaceSize_plus_2 {
			font-size: 14pt;
		}

		.markup .typefaceSize_minus_1 {
			font-size: 8pt;
		}

		.markup .typefaceSize_minus_2 {
			font-size: 7pt;
		}

		.markup .bold {
			font-weight: bold;
		}

		.markup .italic {
			font-style: italic;
		}

		.markup .underline {
			text-decoration: underline;
		}

		.markup .superscript {
			font-size: .83em;
			vertical-align: super;
		}

		.markup .subscript {
			font-size: .83em;
			vertical-align: sub;
		}

		.feedback {
			color: black;
		}

		.redFeedback {
			color: #833;
		}

		</style>
	</head>
	<body>
		{{#completed}}<b style="color:#393">You have completed this task.</b><br/><br/>{{/completed}}

		{{#error}}<br/> <br/><div class="alert">{{error}}</div><br/> <br/>{{/error}}

		{{#message}}
		<br/> <br/>
			<div class="alert {{alertClass}}">
				<h4>{{messageHeader}}</h4>
				{{message}}
			</div>
		<br/> <br/>
		{{/message}}

		{{#pending}}
		<div>
			Waiting for Marking... <span style="background-repeat: no-repeat;background-image: url(data:image/gif;base64,R0lGODlhEAAQAPYAAP///09PT/v7+7Ozs6ysrPLy8tjY2OPj47u7u09PT7CwsNfX13FxcYeHh/Hx8cHBwbS0tPX19aioqGJiYsnJyb+/v7m5uff39/n5+cLCwtzc3H19fVdXV5GRkefn5+7u7tDQ0Gtra3R0dH9/f+Hh4dbW1nh4eISEhHl5eYCAgN7e3tra2o2NjcvLy/Dw8JycnMXFxc3Nzc/Pz4+Pj46OjpKSkqurq+np6aWlpfz8/L6+vl9fX21tbYqKilFRUYaGhtvb23V1dYuLi2BgYPT09OLi4rq6uurq6u3t7Xt7e8TExGdnZ2VlZcbGxp2dnYGBgXJycpiYmN/f39PT02lpaaSkpHx8fIiIiFVVVVRUVMjIyOzs7IODg/j4+MzMzJWVlZaWlubm5r29vVtbW2ZmZgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH+GkNyZWF0ZWQgd2l0aCBhamF4bG9hZC5pbmZvACH5BAAIAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAAQAAAHaIAAgoMgIiYlg4kACxIaACEJCSiKggYMCRselwkpghGJBJEcFgsjJyoAGBmfggcNEx0flBiKDhQFlIoCCA+5lAORFb4AJIihCRbDxQAFChAXw9HSqb60iREZ1omqrIPdJCTe0SWI09GBACH5BAAIAAEALAAAAAAQABAAAAdrgACCgwc0NTeDiYozCQkvOTo9GTmDKy8aFy+NOBA7CTswgywJDTIuEjYFIY0JNYMtKTEFiRU8Pjwygy4ws4owPyCKwsMAJSTEgiQlgsbIAMrO0dKDGMTViREZ14kYGRGK38nHguHEJcvTyIEAIfkEAAgAAgAsAAAAABAAEAAAB2iAAIKDAggPg4iJAAMJCRUAJRIqiRGCBI0WQEEJJkWDERkYAAUKEBc4Po1GiKKJHkJDNEeKig4URLS0ICImJZAkuQAhjSi/wQyNKcGDCyMnk8u5rYrTgqDVghgZlYjcACTA1sslvtHRgQAh+QQACAADACwAAAAAEAAQAAAHZ4AAgoOEhYaCJSWHgxGDJCQARAtOUoQRGRiFD0kJUYWZhUhKT1OLhR8wBaaFBzQ1NwAlkIszCQkvsbOHL7Y4q4IuEjaqq0ZQD5+GEEsJTDCMmIUhtgk1lo6QFUwJVDKLiYJNUd6/hoEAIfkEAAgABAAsAAAAABAAEAAAB2iAAIKDhIWGgiUlh4MRgyQkjIURGRiGGBmNhJWHm4uen4ICCA+IkIsDCQkVACWmhwSpFqAABQoQF6ALTkWFnYMrVlhWvIKTlSAiJiVVPqlGhJkhqShHV1lCW4cMqSkAR1ofiwsjJyqGgQAh+QQACAAFACwAAAAAEAAQAAAHZ4AAgoOEhYaCJSWHgxGDJCSMhREZGIYYGY2ElYebi56fhyWQniSKAKKfpaCLFlAPhl0gXYNGEwkhGYREUywag1wJwSkHNDU3D0kJYIMZQwk8MjPBLx9eXwuETVEyAC/BOKsuEjYFhoEAIfkEAAgABgAsAAAAABAAEAAAB2eAAIKDhIWGgiUlh4MRgyQkjIURGRiGGBmNhJWHm4ueICImip6CIQkJKJ4kigynKaqKCyMnKqSEK05StgAGQRxPYZaENqccFgIID4KXmQBhXFkzDgOnFYLNgltaSAAEpxa7BQoQF4aBACH5BAAIAAcALAAAAAAQABAAAAdogACCg4SFggJiPUqCJSWGgkZjCUwZACQkgxGEXAmdT4UYGZqCGWQ+IjKGGIUwPzGPhAc0NTewhDOdL7Ykji+dOLuOLhI2BbaFETICx4MlQitdqoUsCQ2vhKGjglNfU0SWmILaj43M5oEAOwAAAAAAAAAAAA==);padding-left:24px; padding-top: 1px; color: #444; font-family:\'Helvetica Neue\',Helvetica,Arial,sans-serif"></span></div>

		<script>
			var markingPoller = setInterval( function() {
				$.getJSON('./status', 
					function( result ) {
						if (!result.pending) {
							clearInterval(markingPoller);
							window.location.reload();
						}
					}
				);
			}, 2000 );
		</script>
		{{/pending}}

		<div class="container" style="width: 740px">
			<form method="post" id="submitForm" class="form-horizontal">
				<fieldset>
					{{&csrf_token}}
					<input type="hidden" id="form-action" name="action" value="saveProgram">
					

					{{#comments}}
					<b class="{{feedbackClass}}">{{feedbackHeader}}</b><br>
					<div class="markup">
						{{&comments}}
					</div>
					<br>
					{{/comments}}

					<legend>My Solution:</legend>
					<div class="control-group">
						<textarea name="fileData" id="fileData" style="width: 640px; height: 200px;">{{fileData}}</textarea>
						{{#url}}<span class="help-block pull-right" style="font-size: 10px">Permalink: <a href="{{url}}" target="_blank">{{url}}</a></span>{{/url}}
					</div>


					<div class="hide" id="submission-result">
					</div>

					<div id="submitButtons" class="form-actions">
						<button id="submitButton" class="btn btn-success" style="float: right" data-loading-text="Marking..." {{#pending}}disabled="disabled"{{/pending}}>Submit for Marking {{#completed}}Again{{/completed}}</button>
						<button type="submit" class="btn btn-primary">Save Draft</button>
					</div>
				</fieldset>
			</form>
		</div>

		<script>
			var editor = CodeMirror.fromTextArea( document.getElementById("fileData"), {
				lineNumbers: true,
				mode: "text/x-csrc",
				indentUnit: 3,
				smartIndent: true,
				onUpdate: function( ) {
					window.app.resize();
				}
			} );

			$('#submitButton').click( function( ) {
				$(this).button('loading');
				editor.save();
				$('#form-action').val("submit");
				$.ajax({
					type: 'POST',
					url: './submit',
					dataType: 'json',
					data: $('#submitForm').serialize(),
					success: function( result ) {
						var resultContainer = $('#submission-result');
						if (result.error) {
							resultContainer.text( result.error );
							resultContainer.addClass( 'alert' );
							resultContainer.addClass( 'alert-error' );
							$(this).button('reset');

							resultContainer.fadeIn( function() {
								window.app.resize();
							} );
						} else {
							window.location.reload();
						}
						
						$('#form-action').val("saveProgram");
					}
				});
				return false;
			} );

			window.app.ready( function() {
    			window.app.sendMessage( 'updateProgress', {} );
    		} );
		</script>
	</body>
</html>
